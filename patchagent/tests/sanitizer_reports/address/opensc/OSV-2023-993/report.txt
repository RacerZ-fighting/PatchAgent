=================================================================
==14==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7f6611f9261f at pc 0x55eb93f9ecb5 bp 0x7fff64142810 sp 0x7fff64142808
READ of size 1 at 0x7f6611f9261f thread T0
SCARINESS: 27 (1-byte-read-stack-buffer-overflow)
    #0 0x55eb93f9ecb4 in entersafe_reverse_buffer /src/opensc/src/libopensc/card-entersafe.c:123:13
    #1 0x55eb93f98516 in entersafe_gen_key /src/opensc/src/libopensc/card-entersafe.c:1445:2
    #2 0x55eb93f8bbce in entersafe_card_ctl_2048 /src/opensc/src/libopensc/card-entersafe.c:1647:10
    #3 0x55eb93e2c703 in sc_card_ctl /src/opensc/src/libopensc/card.c:1122:7
    #4 0x55eb94292975 in entersafe_generate_key /src/opensc/src/pkcs15init/pkcs15-entersafe.c:443:6
    #5 0x55eb93da2c28 in sc_pkcs15init_generate_key /src/opensc/src/tests/fuzzing/../../../src/pkcs15init/pkcs15-lib.c:1611:6
    #6 0x55eb93dd0d42 in do_generate_key /src/opensc/src/tests/fuzzing/fuzz_pkcs15init.c:207:9
    #7 0x55eb93dd1f36 in LLVMFuzzerTestOneInput /src/opensc/src/tests/fuzzing/fuzz_pkcs15init.c:337:5
    #8 0x55eb93c40c90 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerLoop.cpp:614:13
    #9 0x55eb93c2bf05 in fuzzer::RunOneTest(fuzzer::Fuzzer*, char const*, unsigned long) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:327:6
    #10 0x55eb93c3199f in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerDriver.cpp:862:9
    #11 0x55eb93c5cc42 in main /src/llvm-project/compiler-rt/lib/fuzzer/FuzzerMain.cpp:20:10
    #12 0x7f661271a082 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x24082) (BuildId: 0702430aef5fa3dda43986563e9ffcc47efbd75e)
    #13 0x55eb93c240ed in _start (/out/fuzz_pkcs15init+0x1f30ed)

DEDUP_TOKEN: entersafe_reverse_buffer--entersafe_gen_key--entersafe_card_ctl_2048
Address 0x7f6611f9261f is located in stack of thread T0 at offset 543 in frame
    #0 0x55eb93f96b0f in entersafe_gen_key /src/opensc/src/libopensc/card-entersafe.c:1373

DEDUP_TOKEN: entersafe_gen_key
  This frame has 3 object(s):
    [32, 136) 'apdu' (line 1376)
    [176, 476) 'rbuf' (line 1377)
    [544, 548) 'sbuf' (line 1378) <== Memory access at offset 543 underflows this variable
HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork
      (longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow /src/opensc/src/libopensc/card-entersafe.c:123:13 in entersafe_reverse_buffer
Shadow bytes around the buggy address:
  0x7f6611f92380: f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5 f5
  0x7f6611f92400: f1 f1 f1 f1 00 00 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92480: 00 f2 f2 f2 f2 f2 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92580: 00 00 00 00 00 00 00 00 00 00 00 04 f2 f2 f2 f2
=>0x7f6611f92600: f2 f2 f2[f2]04 f3 f3 f3 00 00 00 00 00 00 00 00
  0x7f6611f92680: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92700: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92780: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92800: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x7f6611f92880: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==14==ABORTING
